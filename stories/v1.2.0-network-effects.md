# Story: v1.2.0 网络效果

> 实现函数式网络抽象，提供 TCP/UDP/WebSocket 客户端支持

## 目标

扩展 zigFP 的网络能力：

- TCP 客户端 - 同步 TCP 连接和数据传输
- UDP 客户端 - 无连接数据报传输
- 网络效果系统 - 函数式网络操作抽象
- WebSocket 客户端 - 双向通信支持

## 验收标准

### TCP 客户端 (tcp.zig)

- [x] TcpClient 类型 - TCP 连接管理
- [x] connect/disconnect - 连接控制
- [x] send/receive - 数据收发
- [x] 超时配置
- [x] 错误处理
- [x] 单元测试 (8 tests)
- [x] 文档

### UDP 客户端 (udp.zig)

- [x] UdpSocket 类型 - UDP 套接字管理
- [x] bind - 绑定本地地址
- [x] sendTo/receiveFrom - 数据报收发
- [x] 广播支持
- [x] 单元测试 (8 tests)
- [x] 文档

### 网络效果系统 (network.zig)

- [x] NetworkOp - 网络操作类型
- [x] NetworkEffect - 网络效果
- [x] TcpConnect/TcpSend/TcpReceive 效果
- [x] UdpSend/UdpReceive 效果
- [x] NetworkHandler - 效果处理器
- [x] 单元测试 (7 tests)
- [x] 文档

### WebSocket 客户端 (websocket.zig)

- [x] WebSocketClient 类型
- [x] connect/close - 连接控制
- [x] sendText/sendBinary - 发送消息
- [x] receive - 接收消息
- [x] ping/pong 心跳
- [x] 单元测试 (15 tests)
- [x] 文档

### 集成

- [x] root.zig 导出新模块
- [x] 更新 CHANGELOG.md
- [x] 所有测试通过 (647 tests)

## 完成状态

- 开始日期: 2026-01-02
- 完成日期: 2026-01-02
- 状态: ✅ 已完成

## 实现详情

### TCP 客户端 API

```zig
// 直接连接
var client = try TcpClient.connect(allocator, "127.0.0.1", 8080, .{});
defer client.close();
try client.sendAll("Hello");
const data = try client.receive(allocator);
defer allocator.free(data);

// 使用 Builder
var builder = tcpClient(allocator);
var client = try builder.connectTimeout(5000).noDelay(true).connect("host", port);
```

### UDP 客户端 API

```zig
// 绑定并发送
var socket = try UdpSocket.bind(allocator, "0.0.0.0", 0, .{});
defer socket.close();
try socket.sendToAddress("Hello", "127.0.0.1", 8080);
const result = try socket.receiveFrom(&buffer);

// 使用 Builder
var builder = udpSocket(allocator);
var socket = try builder.broadcast(true).bind("0.0.0.0", 0);
```

### 网络效果 API

```zig
// 创建效果
const effect = NetworkEffect.tcpConnect("127.0.0.1", 8080);

// 使用处理器运行
var handler = NetworkHandler.init(allocator);
defer handler.deinit();
const result = handler.run(effect);

// 序列化多个效果
var seq = try NetworkSequence.init(allocator);
defer seq.deinit();
_ = try seq.tcpConnect("host", port);
_ = try seq.tcpSend(conn_id, "data");
const results = try seq.runAll(&handler);
```

### WebSocket 客户端 API

```zig
// 连接
var client = try WebSocketClient.connect(allocator, "ws://localhost:8080/ws", .{});
defer client.close();

// 发送消息
try client.sendText("Hello WebSocket!");
try client.sendBinary(binary_data);

// 接收消息
var msg = try client.receive();
defer msg.deinit(allocator);
if (msg.getText()) |text| {
    // 处理文本消息
}

// 心跳
try client.sendPing("ping");
```

## 测试结果

- TCP 模块: 8 tests passed
- UDP 模块: 8 tests passed
- Network 模块: 7 tests passed
- WebSocket 模块: 15 tests passed
- 总计: 647 tests passed (新增 38 tests)
