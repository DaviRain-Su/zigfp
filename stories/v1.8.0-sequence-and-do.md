# Story: v1.8.0 序列工具与 Do Notation

> 增强序列操作工具和模拟 Haskell 的 do-notation

## 目标

1. 添加序列操作工具函数
2. 实现 Do-notation 风格的 Monad 组合
3. 增强 Reader/Writer/State Monad 工具函数

## 验收标准

### 序列工具 (data/sequence.zig)

- [x] `zipWith` - 使用函数合并两个序列
- [x] `zip3` - 合并三个序列为三元组
- [x] `unzip` - 将 Pair 序列分解为两个序列
- [x] `intersperse` - 在元素之间插入分隔符
- [x] `intercalate` - 使用分隔序列连接序列
- [x] `chunksOf` - 将序列分成固定大小的块
- [x] `sliding` - 滑动窗口视图
- [x] `transpose` - 转置二维序列
- [x] 单元测试

### Do-Notation 构建器 (monad/do_notation.zig)

- [x] `DoOption(T)` - Option Monad Do-notation 构建器
- [x] `DoResult(T, E)` - Result Monad Do-notation 构建器
- [x] `DoList(T)` - 列表推导风格构建器
- [x] `andThen` - bind (>>=) 操作
- [x] `then` - 执行动作但忽略结果
- [x] `pure` - 返回最终值
- [x] `guard` - 条件检查
- [x] 支持 Option Monad
- [x] 支持 Result Monad
- [x] 单元测试

### Reader/Writer/State 增强 (monad/)

- [x] `Reader.local` - 在局部环境中运行 (LocalReader)
- [x] `Reader.withReader` - 使用环境提取器 (ReaderWithEnv)
- [x] `Writer.listens` - 监听输出并转换
- [x] `Writer.censor` - 修改输出 (已有)
- [x] `Writer.passWithModifier` - 传递修改函数
- [x] `State.gets` - 使用函数获取状态的一部分
- [x] `State.putValue` - 设置状态
- [x] `State.modifyGet` - 修改并返回旧值
- [x] 单元测试

### 集成

- [x] root.zig 导出
- [x] data/mod.zig 导出
- [x] monad/mod.zig 导出
- [x] 文档更新 (CHANGELOG.md)
- [x] 所有测试通过 (836 tests)

## 技术说明

### Do-Notation 设计

由于 Zig 不支持 Haskell 风格的 do-notation，我们使用构建器模式：

```zig
// Haskell:
// do
//   x <- Just 10
//   y <- Just 2
//   guard (x > y)
//   pure (x + y)

// zigFP:
const result = DoOption(i32)
    .pure(10)
    .andThen(i32, struct {
        fn f(x: i32) Option(i32) {
            return Option(i32).Some(x * 2);
        }
    }.f)
    .guard(isPositive)
    .run();
```

### 序列工具示例

```zig
// zipWith
const result = try zipWith(i32, i32, i32, allocator, &as, &bs, add);
// result = [11, 22, 33]

// intersperse
const result = try intersperse(i32, allocator, &[_]i32{1, 2, 3}, 0);
// result = [1, 0, 2, 0, 3]

// chunksOf
const result = try chunksOf(i32, allocator, &[_]i32{1, 2, 3, 4, 5}, 2);
// result = [[1, 2], [3, 4], [5]]
```

## 完成状态

- 开始日期: 2026-01-02
- 完成日期: 2026-01-02
- 状态: ✅ 已完成
