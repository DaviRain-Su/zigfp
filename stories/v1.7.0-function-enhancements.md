# Story: v1.7.0 函数增强与 Curry

> 增强函数式工具：柯里化、增强管道操作、更多 Monoid 实例

## 目标

实现经典函数式编程中的柯里化（Currying）和反柯里化（Uncurrying），
增强管道操作符，并添加更多实用的 Monoid 实例。

## 验收标准

### 柯里化 (function.zig)

- [x] `curry2` - 将二元函数转为柯里化形式 f(a, b) -> f(a)(b)
- [x] `curry3` - 将三元函数转为柯里化形式 f(a, b, c) -> f(a)(b)(c)
- [x] `uncurry2Call` - 反柯里化调用二元函数
- [x] `uncurry3Call` - 反柯里化调用三元函数
- [x] `Const`/`const_` - 常量函数
- [x] 单元测试覆盖基本用例和类型转换 (10 tests)

### 增强管道 (pipe.zig)

- [x] `Pipe.map` - 映射操作
- [x] `Pipe.filter` - 条件过滤，返回 Option
- [x] `Pipe.satisfies` - 检查值是否满足谓词
- [x] `Pipe.zip` - 配对操作
- [x] `Pipe.branch` - 条件分支
- [x] `Pipe.repeat` - 重复应用
- [x] `Pipe.debug` - 调试输出
- [x] `OptionPipe` - 处理可选值的管道类型
- [x] `OptionPipe.map`/`flatMap`/`filter` - 核心操作
- [x] `OptionPipe.and_`/`or_` - 逻辑组合
- [x] 单元测试 (25+ tests)

### 更多 Monoid 实例 (monoid.zig)

- [x] `firstMonoid` - First Monoid (保留第一个非空值)
- [x] `lastMonoid` - Last Monoid (保留最后一个非空值)
- [x] `endoMonoid` - Endo Monoid (函数组合)
- [x] `DualMonoid` - Dual Monoid 工具类型
- [x] `dualSumMonoidI32`/`dualSubMonoidI32` - 预定义 Dual 实例
- [x] 浮点数 Monoid (`sumMonoidF64`, `productMonoidF64`, `sumMonoidF32`, `productMonoidF32`)
- [x] 单元测试和法则验证 (12+ tests)

### 集成

- [x] root.zig 导出新增类型和函数
- [x] function/mod.zig 导出
- [x] algebra/mod.zig 导出
- [x] CHANGELOG.md 更新
- [x] 所有测试通过 (789 tests)

## 技术说明

### 柯里化在 Zig 中的实现

由于 Zig 不支持闭包，柯里化使用结构体存储中间状态：

```zig
pub fn Curry2(comptime A: type, comptime B: type, comptime C: type) type {
    return struct {
        f: *const fn (A, B) C,

        pub fn apply(self: Self, a: A) Curry2Applied(A, B, C) {
            return Curry2Applied(A, B, C).init(self.f, a);
        }
    };
}

// 使用示例
const curriedAdd = curry2(i32, i32, i32, add);
const add5 = curriedAdd.apply(5);
const result = add5.apply(3); // 8
```

### First/Last Monoid

```zig
// First: 保留第一个非空值
const items = [_]First(i32){ First(i32).none(), First(i32).some(1), First(i32).some(2) };
const result = firstMonoid(i32).concat(&items); // Some(1)

// Last: 保留最后一个非空值
const result = lastMonoid(i32).concat(&items); // Some(2)
```

### OptionPipe 链式操作

```zig
const result = OptionPipe(i32).some(5)
    .map(i32, double)           // Some(10)
    .filter(isPositive)         // Some(10)
    .flatMap(i32, safeDivide)   // 可能是 Some 或 None
    .unwrapOr(0);               // 获取值或默认值
```

## 完成状态

- 开始日期: 2026-01-02
- 完成日期: 2026-01-02
- 状态: ✅ 已完成
