# Story: v0.9.0 HTTP 客户端

> 实现函数式HTTP客户端，基于Zig 0.15 HTTP API

## 目标

创建类型安全、函数式的HTTP客户端，提供：

- HTTP请求/响应抽象
- 函数式组合操作
- 错误处理和类型安全
- 集成到效果系统中

## 验收标准

### HTTP 核心功能 (http.zig)

- [x] `HttpRequest` - HTTP请求类型定义
- [x] `HttpResponse` - HTTP响应类型定义
- [x] `HttpClient` - HTTP客户端实现
- [x] `HttpEffect` - HTTP效果类型
- [x] 请求构建器函数
- [x] 响应处理器函数

### 函数式操作

- [x] `sendRequest` - 发送HTTP请求效果
- [x] `parseJsonResponse` - 解析JSON响应
- [x] `handleHttpError` - HTTP错误处理
- [x] `withTimeout` - 请求超时控制 (通过RetryConfig)
- [x] `withRetry` - 请求重试机制 (RetryableHttpClient)

### 高级特性

- [x] **中间件支持** - MiddlewareChain请求/响应中间件
- [x] **RequestBuilder** - 流畅的请求构建API
- [x] **RetryConfig** - 可配置的重试策略
- [x] **连接池** - 连接复用和池化 (已在 v1.1.0 实现: connection_pool.zig)
- [x] **认证** - 基本认证、Bearer token等 (已在 v1.1.0 实现: auth.zig)

### 集成与测试

- [x] root.zig 导出http模块
- [x] 兼容Zig 0.15 HTTP API
- [x] 完整的单元测试
- [x] 文档和使用示例

## 完成状态

- 开始日期: 2026-01-02
- 完成日期: 2026-01-02
- 状态: ✅ 已完成

## 实现总结

### 已实现的功能

1. **HttpEffect**: HTTP效果类型，集成到效果系统
2. **RetryConfig**: 重试配置
   - max_retries: 最大重试次数
   - base_delay_ms: 基础延迟
   - max_delay_ms: 最大延迟
   - exponential_backoff: 指数退避

3. **RetryableHttpClient**: 带重试的HTTP客户端
4. **RequestBuilder**: 流畅API构建请求
   - method(), url(), header(), body()
   - build(): 构建最终请求

5. **MiddlewareChain**: 中间件链
   - 请求前处理
   - 响应后处理
   - 支持链式组合

6. **parseJsonResponse**: JSON响应解析工具

## 技术考虑

### 类型安全

- **请求构建器**: 链式API构建请求
- **响应类型**: 类型安全的响应处理
- **错误类型**: 详细的HTTP错误分类

### 函数式设计

- **效果集成**: 与现有效果系统集成
- **组合性**: 请求可以自由组合和变换
- **不可变性**: 请求对象不可变，操作返回新对象

### 性能优化

- **连接复用**: HTTP/1.1 keep-alive
- **并发**: 异步请求支持
- **资源管理**: 正确的连接和缓冲区清理
